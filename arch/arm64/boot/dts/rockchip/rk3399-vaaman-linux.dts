// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright (C) 2023 Vicharak Computers LLP
 */

/dts-v1/;

#include "rk3399-vaaman.dtsi"
#include "rk3399-linux.dtsi"
#include "rk3399-vaaman-mipi-txrx.dtsi"
#include <dt-bindings/input/input.h>

/ {
	model = "Vicharak RK3399 VAAMAN VO.3 LINUX";
	compatible = "vicharak,rk3399-vaaman", "rockchip,rk3399";

	aliases {
		mmc0 = &sdmmc;
		mmc1 = &sdhci;
		mmc2 = &sdio0;
	};

	/delete-node/ chosen;
	chosen {
		bootargs = "earlycon=uart8250,mmio32,0xff1a0000 console=ttyFIQ0 coherent_pool=1m";
	};

	adc-keys {
		compatible = "adc-keys";
		io-channels = <&saradc 0>;
		io-channel-names = "buttons";
		poll-interval = <20>;
		keyup-threshold-microvolt = <2600000>;

		noop-key-1 {
			label = "Noop1";
			linux,code = <KEY_LEFT>;
			press-threshold-microvolt = <100000>;
		};

		left-key {
			label = "Left Arrow";
			linux,code = <KEY_RESERVED>;
			press-threshold-microvolt = <450000>;
		};

		right-key {
			label = "Right Arrow";
			linux,code = <KEY_RIGHT>;
			press-threshold-microvolt = <900000>;
		};
	};

	// Power Button: {{{
	gpio_keys: gpio-keys {
		compatible = "gpio-keys";
		autorepeat;
		pinctrl-names = "default";
		pinctrl-0 = <&pwrbtn>;
		status = "okay";

		power {
			debounce-interval = <100>;
			gpios = <&gpio0 RK_PA5 GPIO_ACTIVE_LOW>;
			label = "GPIO Key Power";
			linux,code = <KEY_POWER>;
			wakeup-source;
		};
	};
	// End of Power Button }}}

	gpio_keys_polled: gpio-keys-polled {
		compatible = "gpio-keys-polled";
		pinctrl-names = "up", "down";
		pinctrl-0 = <&upbtn>, <&downbtn>;
		poll-interval = <20>;
		status = "okay";

		up {
			gpios = <&gpio4 RK_PA5 GPIO_ACTIVE_HIGH>;
			label = "GPIO Key Up";
			linux,code = <KEY_UP>;
		};

		down {
			gpios = <&gpio4 RK_PD6 GPIO_ACTIVE_HIGH>;
			label = "GPIO Key Down";
			linux,code = <KEY_DOWN>;
		};
	};
};

&fiq_debugger {
	status = "okay";
};

// DSI: {{{
&waveshare_panel {
	status = "okay";
};

&dsi {
	status = "okay";

	ports {
		#address-cells = <1>;
		#size-cells = <0>;

		port@1 {
			reg = <1>;

			dsi_out_panel: endpoint {
				remote-endpoint = <&panel_in_dsi>;
			};
		};
	};
};

&dsi_in_vopl {
	status = "disabled";
};

&dsi_in_vopb {
	status = "okay";
};

&route_dsi {
	status = "okay";
	connect = <&dsi_in_vopb>;
};
// End of DSI }}}

&display_subsystem {
	status = "okay";
};

// HDMI: {{{
&hdmi {
	status = "disabled";
};

&hdmi_in_vopb {
	status = "disabled";
};

&hdmi_sound {
	status = "disabled";
};

&route_hdmi {
	connect = <&vopb_out_hdmi>;
	status = "disabled";
};
// End of HDMI }}}

&pinctrl {
	// Power Button: {{{
	power-button {
		pwrbtn: pwrbtn {
			rockchip,pins =
				<0 RK_PA5 RK_FUNC_GPIO &pcfg_pull_up>;
		};

		upbtn: upbtn {
			rockchip,pins =
				<4 RK_PD6 RK_FUNC_GPIO &pcfg_pull_none>;
		};

		downbtn: downbtn {
			rockchip,pins =
				<4 RK_PA5 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};
	// End of Power Button }}}
};
